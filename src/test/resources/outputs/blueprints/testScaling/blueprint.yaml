tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.2/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.2/plugin.yaml

node_types:

  _a4c_generated_type.openstack.Compute:
    derived_from: cloudify.openstack.nodes.Server
    properties:
      a_simple_test:
        default: defaultTest

node_templates:

  LoadBalancerCompute:
    type: cloudify.openstack.nodes.Server
    properties:
      server:
        image: 02ddfcbb-9534-44d7-974d-5cfd36dfbcab
        flavor: 2
    instances:
      deploy: 1

  LoadBalancer:
    type: cloudify.nodes.ApplicationModule
    relationships:
      - target: LoadBalancerCompute
        type: cloudify.relationships.contained_in

  WebAppCompute:
    type: _a4c_generated_type.openstack.Compute
    properties:
      a_simple_test: test
      server:
        image: 02ddfcbb-9534-44d7-974d-5cfd36dfbcab
        flavor: 2
    instances:
      deploy: 2

  WebApp:
    type: cloudify.nodes.ApplicationModule
    relationships:
      - target: WebAppCompute
        type: cloudify.relationships.contained_in
      - target: LoadBalancer
        type: cloudify.relationships.connected_to
        target_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure:
              implementation: webAppConnectedToLoadBalancer.py